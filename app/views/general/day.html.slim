- content_for :addjs_in_head
  = javascript_pack_tag 'day_page', 'data-turbolinks-track': 'reload'

#dayPage(data-target-date="#{@date}")
  toast(:showable="toastShowable" :is-error="toastError" :message="toastMessage" @toast-hidden="toastShowable = false")
  / ãƒ¢ãƒ¼ãƒ€ãƒ«ã§æ—¥è¨˜ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®htmlã®ä»•è¾¼ã¿
  modal(v-if="!!modalableDiaryId" :no-padding="true" @on-close="closeDiaryModal")
    template(v-slot:content)
      diary(
        :diary-id="modalableDiaryId"
        :modal-mode="true"
        @submitted="reflectPinnedDiaries"
      )

  / ã€Œæ—¥è¨˜ã«ãƒ¡ãƒ¢ã€ãƒ•ã‚©ãƒ¼ãƒ 
  - append_memo_form = capture do
    #memo-form.modal.fade[tabindex="-1"]
      .modal-dialog
        form.form.form-inline(ref="memoForm" @submit="submitAppendingMemo")
          .modal-content
            .modal-header
              h5.mb-0
                | ğŸ“
                = "#{dispdate(@date, true)}ã®ãƒ¡ãƒ¢"
            .modal-body
              .form-row.mb-2
                .col-6.timepicker.input-group[data-target-input="nearest"]
                  .input-group-prepend
                    .input-group-text[data-target='.timepicker' data-toggle='datetimepicker']
                      = fa_icon 'clock-o', class: 'fa-lg'
                  input.form-control.datetimepicker-input(type="text" name="[diary]time_memo" data-target=".timepicker")
                .col-4
                  select.form-control.w100(name="[diary]label_memo")
                    option(v-for="cate in memoCategories" :value="cate" v-text="cate")
              div
                textarea.form-control.first-focus.w100(name="[diary]memo" v-model="memoContent" ref="memoContentField")
              input(type="hidden" name="[diary]record_at" value="#{@date}")
            .modal-footer.justify-content-between
              small.text-muted
                = fa_icon 'exclamation-circle', class: 'mr-1'
                | ãƒ¡ã‚¤ãƒ³ã®æ—¥è¨˜ã«ãƒ¡ãƒ¢ã‚’è¿½åŠ ã—ã¾ã™ã€‚
                br
                | ãƒ¡ã‚¤ãƒ³æ—¥è¨˜ãŒæœªä½œæˆãªã‚‰åŒæ™‚ã«ä½œæˆã•ã‚Œã¾ã™
              button.btn.btn-primary(type="submit") ãƒ¡ãƒ¢è¿½åŠ 

  .dayContentHeader
    .nav-container
      = link_to day_path(@date - 1), class: 'nav-arrow prev-day', title: 'ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼: shift + <' do
        svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
          polyline points="15 18 9 12 15 6"
      div(style="width:100%")
        button.date-selector(@click="$refs.selectingDateForm.style.display = 'block'")
          = "#{dispdate(@date, true)}"
        form.form.form-inline.mt-2(style="display: none" @submit="moveSpecifiedDatePage" ref="selectingDateForm")
          = date_field_tag 'day-page-date-field', @date, id: 'day-page-date-field', class: 'form-control'
          input(type="submit" class="btn btn-light" value="ç§»å‹•")
      = link_to day_path(@date + 1), class: 'nav-arrow next-day', title: 'ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼: shift + >' do
        svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
          polyline points="9 18 15 12 9 6"

    = append_memo_form
    .action-buttons
      = link_to root_path, class: 'action-button btn-today' do
        span.button-icon
          | ğŸ 
        | ä»Šæ—¥
      button.action-button.btn-memo(@click="showMemoForm")
        span.button-icon
          | ğŸ“
        | æ—¥è¨˜ã«ãƒ¡ãƒ¢
      = link_to month_path(month: @date.to_s(:ym)), class: 'action-button btn-calendar' do
        span.button-icon
          | ğŸ“…
        | æœˆé–“


  .row.justify-content-center
    .sectionHabitRecords.col-md-2
      .page-header
        h4.d-flex.justify-content-between
          | æœ¬æ—¥ã®è¨˜éŒ²
      p(v-if="habit_records.length == 0") ç¿’æ…£ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
      .habit-records(v-else)
        - if browser.device.mobile?
          .mb-3(v-if="!openRecordContents")
            a.btn.btn-sm.btn-light(@click="openRecordContents = true") ã™ã¹ã¦è¡¨ç¤º
        habit-record(v-for="habit_record in habit_records" :habit="habit_record.habit" :record="habit_record.record" target-date="#{@date}" :mobile="#{browser.device.mobile?}" :open-record-contents="openRecordContents" :key="habit_record.habit.id")

    / NOTE: .overflow-autoã‚’ä»˜åŠ ã™ã‚‹ã¨ã€å­è¦ç´ ã®å¹…ãŒé™ç•Œã‚’è¶…ãˆãŸæ™‚ã«ã€ç”»é¢å…¨ä½“ã§ã¯ãªãã€ã“ã®è¦ç´ ã«å¯¾ã—ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
    / ä»˜åŠ ã—ãªã„ã¨ã€ç”»é¢å…¨ä½“ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
    .sectionDiaries.col-md-7.overflow-auto
      .page-header.d-flex
        h4.flex-grow-1
          | æœ¬æ—¥ã®æ—¥è¨˜&nbsp;
          / ã€Œdata-trigger="focus"ã€ã‚’ä¸ãˆã‚‹ã“ã¨ã§ã€æœ¬buttonã§ã¯ãªãã€ä»–ã®å ´æ‰€ã®ã‚¯ãƒªãƒƒã‚¯æ™‚ã«æ¶ˆãˆã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ˆé€†ã«ä¸ãˆãªã„ã¨ã€ä»–ã®å ´æ‰€ã‚¯ãƒªãƒƒã‚¯ã§æ¶ˆãˆãªã„ã®ã§ä¸ä¾¿ã ã£ãŸï¼‰
          button.btn.btn-primary(v-show="diariesWithOpsions.length > 1" data-toggle="popover" data-trigger="focus" title="æ—¥è¨˜ãƒªã‚¹ãƒˆ" :data-content="diary_links_list") {{ diariesWithOpsions.length }}
      .diaries(ref="diariesBody")
        p(v-if="diariesWithOpsions.length == 0") æ—¥è¨˜ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
        .diaries-wrapper.d-flex.flex-row.flex-wrap(v-else)
          / NOTE: basis: autoã«ã™ã‚‹ã¨ã€å¹…ãŒå¤§ãã„è¦ç´ ã¯é ˜åŸŸã‚ã„ã£ã±ã„ã«åºƒãŒã£ã¦æ¬¡ã®è¦ç´ ãŒæ”¹è¡Œã•ã‚Œã¦ã—ã¾ã†ã®ã§NG
          / .flex-grow-1.flex-basis-0 / Diaryã®å¹…ã‚’ç­‰åˆ†ã—ã¦ä¸¦ã¹ã‚‹ã€‚100%ã‚’è¦ç´ æ•°ã§å‰²ã£ã¦ã‚‚åŒã˜ã“ã¨ãŒã§ãã‚‹ã€‚ã“ã®å ´åˆã¯grow-1ã¯ä¸è¦ã«ãªã‚‹ã¯ãš
          / flex-basis:650ã«ã™ã‚‹ã“ã¨ã§ã€diaries-wrapperãŒ1300pxã‚’è¶Šãˆã‚‹å ´åˆã¯Diaryã‚’æ¨ªã«2ã¤ä¸¦ã¹ã€å¦ãªã‚‰1ã¤ã€‚ã„ãšã‚Œã«ã—ã¦ã‚‚Diaryã¯ã‚ã„ã£ã±ã„åºƒãŒã‚‹
          .flex-grow-1.ml-2.mb-3.diary-wrapper(v-for="obj in diariesWithOpsions" style="flex-basis:650px")
            diary(
              :diary="obj.diary"
              :target-date-for-edit-mode="obj.targetDateForEditMode"
              :highlight-for-a-moment="obj.highlightForAMoment"
              :key="`diary-${obj.diary.id}`"
              :categories="categories"
              @content-changed="onContentChanged"
              @submitted="onSubmitted"
              @on-edit-mode="onEditMode"
            )
      p
        a.btn.btn-block.btn-light.ignore-checking-changes(@click="newDiary")
          i.fa.fa-pencil &nbsp;æ—¥è¨˜ã‚’æ›¸ã

    .sectionPinnedDiaries.col-md-3
      .page-header
        h4
          span.mr-2
            i.fa.fa-thumb-tack
          | å›ºå®š
          small.ml-3 = link_to '[ç®¡ç†]', pinned_diaries_path
      .diaries
        .mb-1(v-for="diary in pinnedDiaries" :key="diary.id")
          task-diary(:diary="diary" @updated="showToast" @show-diary-modal="showDiaryModal")

sass:
  /* 2025/01/08 Claudeã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
  .dayContentHeader
    width: 450px;
    padding: 12px;
    box-sizing: border-box;
    margin: 7px auto 5px

    .nav-container
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;

    .nav-arrow
      width: 50px;
      height: 50px;
      background: #ebf5ff;
      border: none;
      border-radius: 8px;
      color: #2563eb;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      cursor: pointer;
      transition: background-color 0.2s;

    .nav-arrow:hover
      background: #dbeafe;

    .nav-arrow svg
      width: 30px;
      height: 30px;
      stroke-width: 2.5;

    .date-selector
      flex: 1;
      height: 50px;
      width: 100%;
      background: white;
      border: 2px solid #2563eb;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      padding: 0 24px;
      font-size: 20px;
      font-weight: bold;
      color: #374151;
      cursor: pointer;
      transition: background-color 0.2s;

    .date-selector:hover
      background: #ebf5ff;

    .date-selector::after
      content: "";
      position: absolute;
      right: 12px;
      width: 8px;
      height: 8px;
      border-left: 2px solid #2563eb;
      border-bottom: 2px solid #2563eb;
      transform: rotate(-45deg) translateY(-2px);

    .action-buttons
      display: flex;
      justify-content: space-between;
      gap: 8px;

    .action-button
      flex: 1;
      height: 36px;
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background-color 0.2s;
    .action-button:hover
      color: white;
      text-decoration: none;

    .btn-today
      background: #16a34a;

    .btn-today:hover
      background: #15803d;

    .btn-memo
      background: #dc2626;

    .btn-memo:hover
      background: #b91c1c;

    .btn-calendar
      background: #06b6d4;

    .btn-calendar:hover
      background: #0891b2;

    .button-icon
      margin-right: 4px;

  @media (max-width: 640px)
    .dayContentHeader
      width: 100%
      padding: 8px;

      .action-buttons
        gap: 4px;
      .action-button
        font-size: 13px;
